# Отчет по выполнению задания DO1_Linux

1. [Part 1. Установка ОС](#part-1-установка-ос)
2. [Part 2. Создание пользователя](#part-2-создание-пользователя)
3. [Part 3. Настройка сети ОС](#part-3-настройка-сети-ос)
4. [Part 4. Обновление ОС](#part-4-обновление-ос)
5. [Part 5. Использование команды sudo](#part-5-использование-команды-sudo)
6. [Part 6. Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)
7. [Part 7. Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)
8. [Part 8. Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)
9. [Part 9. Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)
10. [Part 10. Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)
11. [Part 11. Использование утилиты df](#part-11-использование-утилиты-df)
12. [Part 12. Использование утилиты du](#part-12-использование-утилиты-du)
13. [Part 13. Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)
14. [Part 14. Работа с системными журналами](#part-14-работа-с-системными-журналами)
15. [Part 15. Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)

## Part 1. Установка ОС

- Для выполнения этого задания была установлена программа для работы с виртуальными машинами VirtualBox.
- С официального сайта скачан образ системы Ubuntu версии 20.04.6 Server без графического интерфейса.
- Результат выполнения команды cat /etc/issue

![Результат выполнения команды cat](s21_part1.png "Результат выполнения команды cat")

## Part 2. Создание пользователя

- Введем команду для создания нового пользователя

```
sudo adduser newdesmonsu
```

![Добавления нового пользователя](s21_part2_new_user.png "Добавление нового пользователя")

- Добавим пользователя в группу adm

```
sudo usermod -a -G adm newdesmonsu
```

![Добавление пользователя в группу](s21_part2_group_add.png "Добавление пользователя в группу")

- Выведем список пользователей командой

```
cat /etc/passwd
```

![Вывод passwd](s21_part2_group_result.png "Вывод passwd")

- Пользователь newdesmonsu присутствует в выводе команды

## Part 3. Настройка сети ОС

- Для определения имени машины введем команду

```
hostname
```

- Изменим имя машины на соответствующее заданию с помощью команды

```
sudo hostname user-1
```

![Замена имени](s21_part3_machine_name.png "Замена имени")

- Для того, чтобы имя машины сохранилось после перезагрузки системы можно воспользоваться командой

```
sudo hostnamectl set-hostname user-1
```

![Статичная замена имени](s21_part3_machine_name_after_reboot.png "Статичная замена имени")

- Выведем на экран текущее время машины командой

```
date
```

- Видим, что выставлено время AM UTC. Для смены часового пояса введем команду

```
sudo timedactl set-timezone Europe/Moscow
```

- Повторно введем команду date, чтобы убедиться, что время изменилось.

![Изменение даты на виртуальной машине](s21_part3_date_change.png "Изменение даты на виртуальной машине")

- Для выведения информации о сетевых интерфейсах введем команду

```
ip l
```

![Вывод сетевых интерфейсов](s21_part3_network_interfaces.png "Вывод сетевых интерфейсов")

- Как видим команда вывела нам информацию о сетевых интерфейсах lo и enp0s3

> Интерфейс lo (loopback, localhost) - виртуальный сетевой интерфейс, расположенный по адресу 127.0.0.1, предназначенный для обращения компьютера к самому себе без необходимости выхода в сеть. Интерфейс необходим для корректной работы приложений, использующих сетевой трафик, даже в рамках одного компьютера (тестирование клиент-серверных приложений)

- Выведем в консоль ip-адрес устройства, на котором работаем с помощью команды

```
cat /var/log/syslog | grep -i DHCP
```

![Вывод DHCP-IP](s21_part3_DHCP.png "Вывод DHCP-IP")

- Как видим, нам был выдан Ip-адрес 10.0.2.15

> DHCP (Dynamic Host Configuration Protocol) - это сетевой протокол позволяющий устройствам автоматически получить IP-адрес и другие сетевые параметры необходимые для работы в сети согласно протоколам TCP/IP. Работает по модели клиент-сервер, где клиент посылает запрос маршрутизатору, который выдает устройству свободный адрес и прочие настройки. Данный протокол облегчает работу по настройке сети, позволяя не выделять вручную IP-адреса машинам, подключенным к локальной сети.

- Выведем внешний и внутренний IP-адреса шлюза командами

- для внешнего

```
curl ifconfig.co
```

![Вывод внешнего IP](s21_part3_outer_ip.png "Вывод внешнего IP")

- для внутреннего

```
ip route
```

![Вывод внутреннего IP](s21_part3_inner_ip.png "Вывод внутреннего IP")

- Для установки статического IP отредактируем файл /etc/netplan/00-installer-config.yaml с помощью vim.
- Отключим DHCP, установим адрес локальной сети, внутренний IP и публичные серверы в параметре addresses.

![Настройки Vim для статического IP](s21_part3_vim.png "Настройки Vim для статического IP")

- Перезапустим машину, проверим, что настройки сохранились

![Настройки Vim после reboot](s21_part3_saved.png "Настройки Vim после reboot")

- Пинганем ip 1.1.1.1 и ya.ru

![Ping](s21_part3_ping.png "Ping")

- Как видим на скриншоте, 3 пакета были направлены и все три были получены. Потерь пакетов не наблюдается.

## Part 4 Обновление ОС

- Запустим команду

```
sudo apt update
```

- За ней

```
sudo apt full-upgrade
```

![Обновление ОС](s21_part4_update.png "Обновление ОС")

- Подождем обновления

![Процесс обновления ОС](s21_part4_updating.png "Процесс обновления ОС")

- И повторим команду sudo apt update

![Обновленная ОС](s21_part4_updated.png "Обновленная ОС")

## Part 5 Использование команды Sudo

- Добавим пользователя newdesmonsu в группу sudo командой

```
sudo usermod -a -G -sudo newdesmonsu
```

![Добавление пользователя в группу](s21_part5_sudo_new_user.png "Добавление пользователя в группу")

- Сменим пользователя командой

```
su newdesmonsu
```

![Смена пользователя](s21_part5_user_change.png "Смена пользователя")

- Из под нового пользователя сменим имя машины с использованием команды sudo

```
sudo hostnamectl set_hostname user-2
```

![Смена имени машины](s21_part5_hostname_change.png "Смена имени машины")

- Перезапустим машину, чтобы проверить сохранились ли настройки

![Перезапуск](s21_part5_after_reboot.png "Перезапуск")

> sudo (substitute user and do) - это команда, которая позволяет разрешенным пользователям выполнять команды от имени другого пользователя, чаще всего от имени суперпользователя (root), не зная пароля root. Это основной и рекомендуемый способ выполнения административных задач.

## Part 6. Установка и настройка службы времени

- Запустим команду

```
timedatectl show
```

- Убедимся, что синхронизация включена

![Синхронизация](s21_part6_time.png "Синхронизация")

## Part 7. Установка и использование текстовых редакторов

- Введем команды установки текстовых редакторов: vim, nano, mcedit

```
sudo apt install vim
```

```
sudo apt install nano
```

```
sudo apt install mcedit
```

- Зайдем в первый редактор - vim с помощью команды

```
vim test_vim.txt
```

- Нажмем клавишу i, чтобы перейти в режим редактирования файла (Insert). Введем свой логин.

![Логин VIM](s21_part7_vim.png "Логин VIM")

- Для выхода с сохранением необходимо нажать ESC, чтобы выйти из режима вставки, нажать комбинацию клавиш :wq (write и quit).

![Подтверждение сохранения](s21_part7_vim_saved.png "Подтверждение сохранения")

- Зайдем во второй редактор - nano с помощью команды

```
nano test_nano.txt
```

- Введем свой логин.

![Логин nano](s21_part7_nano.png "Логин nano")

- Для выхода с сохранением необходимо нажать комбинации клавиш Ctrl+S и Ctrl+X.

- Зайдем в третий редактор - mcedit с помощью команды

```
mcedit test_nano.txt
```

- Введем свой логин.

![Логин mcedit](s21_part7_mcedit.png "Логин mcedit")

- Для выхода с сохранением необходимо нажать клавишу F10 и выбрать Yes во всплывающем окне.

![Подтверждение сохранения](s21_part7_mcedit_saved.png "Подтверждение сохранения")

- Снова зайдем в Vim, заменим свой логин на текст 21 school 21.

![Школа VIM](s21_part7_vim_school.png "Школа VIM")

- Чтобы выйти из файла без сохранения нужно ввести команду :q! (Форсированный выход). Проверим, что сохранения не произошло

![cat VIM](s21_part7_vim_cat.png "cat VIM")

- Зайдем в nano и также заменим текст.

- Чтобы выйти из файла без сохранения нужно нажать сочетание клавиш Ctrl+X и отказаться от сохранения буфера.

![Школа nano](s21_part7_nano_school.png "Школа nano")

- Проверим, что сохранения не произошло

![cat nano](s21_part7_nano_cat.png "cat nano")

- Повторим то же в mcedit.

- Чтобы выйти из файла без сохранения нужно нажать клавишу F10 и отказаться от сохранения файла.

![Школа mcedit](s21_part7_mcedit_school.png "Школа mcedit")

- Проверим, что сохранения не произошло

![cat mcedit](s21_part7_mcedit_cat.png "cat mcedit")

- Снова зайдем в Vim и повторно внесем изменения. Для поиска слова в файле наберем в командной строке /{искомое слово}

![поиск Vim](s21_part7_vim_search.png "поиск Vim")

- Для замены слова напишем следующее: s/{искомое слово}/{слово для замены}

![замена в Vim](s21_part7_vim_swap.png "замена в Vim")

- Для поиска слова в редакторе nano используется комбинация Ctrl + W

![поиск nano](s21_part7_nano_search.png "поиск nano")

- Для замены - Ctrl + \

![замена в nano](s21_part7_nano_replace.png "замена в nano")

![замена в nano](s21_part7_nano_swap.png "замена в nano")

- Для поиска в mcedit нажнем клавишу F7

![поиск в mcedit](s21_part7_mcedit_search.png "поиск в mcedit")

![поиск в mcedit](s21_part7_search_result.png "поиск в mcedit")

- Для замены нажмем клавишу F4

- Вводим слово для замены и подтверждаем

![замена в mcedit](s21_part7_mcedit_replace.png "замена в mcedit")

- Подтверждаем замену одного (replase) или всех (all) совпадений

![замена в mcedit](s21_part7_mcedit_replace_confirm.png "замена в mcedit")

- Получаем результат

![замена в mcedit](s21_part7_mcedit_swap.png "замена в mcedit")

## Part 8. Установка и базовая настройка сервиса SSHD

- Установим службу SSHd с помощью команды:

```
sudo apt install openssh-server
```

- Узнаем состояние SSHd службы, воспользовавшись командой:

```
sudo systemctl status ssh
```

![Статус службы SSHd](s21_part8_SSHd_status.png "Статус службы SSHd")

- Для перенастройки службы SSHd на порт 2022 откроем файл sshd_config командой

```
sudo vim /etc/ssh/sshd_config
```

- Раскомментируем строчку с портом и заменим его на 2022

![Смена порта](s21_part8_port_change.png "Смена порта")

- Чтобы применить внесенные изменения перезапустим службу ssh

```
sudo systemctl restart ssh
```

- Проверим изменился ли порт?

![Измененный порт](s21_part8_port_changed.png "Измененный порт")

- На скриншоте видно, что порт соответствует заданному

- Разрешим брендмауеру принимать входящие запросы от всех адресов, иначе он будет блокировать все попытки подключения. Сделать это можно командой

```
sudo ufw allow 2022/tcp
```

![Обновленные настройки бм](s21_part8_new_port.png "Обновленные настройки бм")

- Проверим наличие процесса sshd, используя команду

```
ps aux | grep -i ssh
```

![Использование утилиты ps aux](s21_part8_sshd_process_psaux.png "Использование утилиты ps aux")

> ps (process status) - утилита для просмотра списка процессов в Linux. Она показывает статическое состояние процессов, запущенных на момент выполнения команды. <br>
> Ключевые параметры:<br>
> -a - процессы всех пользователей<br>
> -u - пользовательско-ориентированный формат<br>
> -x - позволяет ps перечислить процессы не привязанные к управляющему терминалу<br>
> grep -i ssh - выводит строчки, где есть ssh с игнорированием регистра<br>
> | - pipe (конвейер) перенаправляет вывод одной команды в стандартный ввод другой

- Выполним перезагрузку машины с помощью команды reboot и выполним команду

```
netstat -tan
```

![Команды netstat](s21_part8_netstat.png "Команды netstat")

- Вывод команды содержит tcp 0 0 0.0.0.0:2022 0.0.0.0:\* LISTEN

> Команда netstat (network statistics) - это инструмент командной строки, который отображает сетевые соединения, таблицы маршрутизации, статистику интерфейсов, маскирующие соединения и членство в мультикаст-группах.
> -t - отображает TCP-соединения
> -a - вывод всех активных подключений TCP и прослушиваемых портов TCP и UDP.
> -n - отображает числовые адреса вместо разрешения хостов и имен служб

> Привызове команды в терминал выводится таблица со следующими полями:
>
> - Proto (protocol) - сетевой протокол (tcp, udp);
> - Recv-Q (recieve queue) - количество байт, помещенных в буфер приема, еще не прочитанных процессом
> - Send-Q (send queue) - количество байт в очереди на отправку, еще не подтвержденных удаленной стороной
> - Local Address - Адрес и порт локальной машины
>   Значение 0.0.0.0 в этом контексте означет, что служба готова принять подключение на любой свой сетевой интерфейс
> - Foreign Adress - Адрес и порт удаленной машины
>   Значение 0.0.0.0 в этом контексте означет, что служба готова принять подключение с любого сетевого интерфейса и любого IP-адреса в сети
> - State - Состояние соединения

## Part 9. Установка и использование утилит top, htop

- Введем в консоль команду top, она выводит на экран

![Команда top](s21_part9_top.png "Команда top")

> Uptime - 2 минуты<br>
> Количество авторизированных пользователей - 1 пользователь.<br>
> Средняя загрузка системы - 0.38 за одну минуту, 0.33 за пять минут, 0.14 за 15 минут.<br>
> Общее количество процессов - 117.<br>
> Загрузка cpu - 0.07 (0.05 - системные процессы, 0.02 - ожидание i/o операций, 99.3 - простой).<br>
> Загрузка памяти - 162.3 из 1971.3.<br>
> Pid процесса, занимающего больше всего памяти - 1.<br>
> Pid процесса, занимающего больше всего процессорного времени - 1355.<br>

- Вывод команды htop без сортировки

![Команда htop](s21_part9_htop.png "Команда htop")

- Отсортируем вывод команды. Для этого нажнеи на клавишу F6 и выберем параметр сортировки.

- По PID

![Команда htop pid](s21_part9_htop_pid.png "Команда htop pid")

- PERCENT_CPU

![Команда htop percent CPU](s21_part9_htop_percent_CPU.png "Команда htop percent CPU")

- PERCENT_MEM

![Команда htop percent mem](s21_part9_htop_percent_mem.png "Команда htop percent mem")

- TIME

![Команда htop time](s21_part9_htop_time.png "Команда htop time")

- Для использования фильтров необходимо нажать клавишу F4 и ввести параметр фильтрации. htop отфильтрованный по sshd

![Команда htop filter](s21_part9_htop_filter.png "Команда htop filter")

- Для поиска необходимо нажать клавишу F3 и ввести искомую строку, например syslog.

![Команда htop search](s21_part9_syslog_search.png "Команда htop search")

- Для отображения дополнительных переметров нужно нажать клавишу F2 и выбрать нужные.

![Команда htop additional params](s21_part9_htop_with_new_params.png "Команда htop additional params")

## Part 10. Использование утилиты fdisk

- Выполним команду:

```
fdisk -l
```

![Команда fdisk](s21_part10_fdisk_l.png "Команда fdisk")

> Название диска - VBOXHARDDISK<br>
> Размер диска - 40 GB<br>
> Количество секторов - 83886080<br>

- Чтобы узнать размер swap выполним команду:

```
free -h
```

![Команда fdisk swap](s21_part10_swap.png "Команда fdisk swap")

- Размер swap - 2.0 GB

## Part 11. Использование утилиты df

- Выполним команды

```
df
```

- и для вывода корневого раздела

```
df /
```

![Команда df](s21_part11_df.png "Команда df")

> Размер корневого раздела: 19430032<br>
> Размер занятого пространства: 5067408<br>
> Размер свободного пространства: 13350300<br>
> Процент использования: 28%<br>
> Единицы измерения при выводе - килобайты<br>

- Выполним команду:

```
df -Th
```

- и для вывода корневого раздела

```
df -Th /
```

![Команда df с флагом Th](s21_part11_df_Th.png "Команда df с флагом Th")

> Размер корневого раздела: 19G<br>
> Размер занятого пространства: 4.9G<br>
> Размер свободного пространства: 13G<br>
> Процент использования: 28%<br>
> Единицы измерения при выводе - гигабайты<br>

> Тип файловой системы (Fourth Extended File System) - ext4 - это современная журналируемая файловая система для Linux, пришедшая на смену ext3. В ссравнении с ext3 увеличено адресное пространсство и значительно увеличена скорость работы с данными.

## Part 12. Использование утилиты du

- Выполним команду

```
du
```

![Команда du](s21_part12_du.png "Команда du")

- Вывод размера папки home в бвйтах и человекочитаемом виде

```
sudo du -s /home/
```

```
sudo du -sh /home/
```

![Команда du sh](s21_part12_du_home.png "Команда du sh")

- Вывод размера папки /var в бвйтах и человекочитаемом виде

```
sudo du -s /var/
```

```
sudo du -sh /var/
```

![Команда du var](s21_part12_du_var.png "Команда du var")

- Вывод размера папки /var/log в бвйтах и человекочитаемом виде

```
sudo du -s /var/log/
```

```
sudo du -sh /var/log/
```

![Команда du var/log](s21_part12_var_log.png "Команда du var/log")

- Вывод размеров содержимого папки /var/log/\*

```
sudo du var/log/* | less
```

![Команда du var/log all](s21_part12_var_log_all.png "Команда du var/log all")

## Part 13. Установка и использование утилиты ncdu

- Установим утилиту ncdu

```
sudo apt install ncdu
```

![Команда ncdu install](s21_part13_ncdu.png "Команда ncdu install")

- Выведем размер папки /home:

![Команда ncdu home](s21_part13_ncdu_home.png "Команда ncdu home")

- папки /var:

![Команда ncdu var](s21_part13_ncdu_var.png "Команда ncdu var")

- и подпапки /var/log:

![Команда ncdu var/log](s21_part13_var_log.png "Команда ncdu var/log")

- Размеры совпадают с размерами из 12 части.

## Part 14. Работа с системными журналами

- Откроем для просмотра файл /var/log/dmesg

![dmesg](s21_part14_dmesg.png "dmesg")

- файл /var/log/syslog

![syslog](s21_part14_syslog.png "syslog")

- и /var/log/auth.log

![auth](s21_part14_auth_log.png "auth")

- Время последней успешной авторизации - Sep 22 19:17:01
- Имя пользователя: отсутствует (CRON)
- Метод входа в систему: by uid = 0 (User Identifier)

- Время последней успешной авторизации пользователя - Sep 22 19:16:16
- Имя пользователя: desmonsu
- Метод входа в систему: by uid = 0 (User Identifier).

- Перезапустим службу SSHd с помощью команды

```
sudo systemctl restart ssh
```

- и найдем сообщение о перезапуске службы

![sshd restart](s21_part14_syslog_restart.png "sshd restart")

## Part 15. Использование планировщика заданий CRON

- Запустим команду uptime с выводом в файл через каждые 2 минуты.

```
crontab -e
```

- Добавим строчку _/2 _ \* \* \* uptime >> /tmp/uptime.log 2>&1

![cron в vim](s21_part15_uptime_vim.png "cron в vim")

- Сохраним и закроем файл.

- Откроем файл лога.

![logs](s21_part15_cron_log.png "logs")

- Выведем список заданий для CRON

```
crontab -l
```

![tasks](s21_part15_cron_tasks.png "tasks")

- Очистим список заданий

```
crontab -r
```

- Повторно проверим вывод

![clear](s21_part15_cron_cleared.png "clear")
